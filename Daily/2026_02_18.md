# 2026-02-18 Daily Log

## 오늘 목표
- backend 실행/배포 방향 확인
- mock 데이터 기반 `crawler -> backend -> DB` 흐름 검증
- Supabase 연결 전환 및 적재 확인

## 수행 내용
1. backend 실행 기준 확인
- `backend/api`는 FastAPI + SQLAlchemy 구조
- 초기 확인 시 로컬(SQLite) 개발 가능 구조였고, 오늘 작업으로 Supabase Postgres 연동까지 완료

2. mock 기반 E2E 테스트 수행
- 데이터: `data/mock_baseball/20250902WOSK02025`
- ingest 호출로 `receivedEvents=519` / `insertedEvents=519` 확인
- 동일 데이터 재전송 시 `insertedEvents=0` / `duplicateEvents=519` 확인

3. 테스트 산출물 정리
- `Test` 폴더 생성
- 테스트 로그/DB 파일 이동 및 `Test/README.md` 작성
- 결과 조회용 `Test/supabase_result_queries.sql` 추가

4. Supabase 연결 전환
- `backend/api/.env`를 Supabase Session Pooler 기준으로 세팅
- 연결 이슈 점검 후 URL 스킴을 `postgresql+psycopg://`로 보정

5. 코드 수정 (Supabase jsonb 정합성)
- `backend/api/app/models.py`
- `backend/api/app/services.py`
- `game_events.payload_json` 저장 타입을 JSON으로 맞춤
- metadata 저장 시 문자열 직렬화 대신 dict를 그대로 저장하도록 수정

## 검증 결과
- `backend/api` 테스트: `pytest -q` -> `2 passed`
- Supabase 최종 적재 확인
  - `public.games`: 1
  - `public.game_events`: 519
- 게임 상태/이벤트 조회 API 정상 응답 확인

## 변경 파일
- `.gitignore`
- `AGENTS.md`
- `Daily/2026_02_18.md`
- `backend/api/.env`
- `backend/api/app/models.py`
- `backend/api/app/services.py`
- `backend/api/tests/test_backend.db` (pytest 실행으로 갱신)
- `Test/README.md`
- `Test/supabase_result_queries.sql`
- `Test/*` (테스트 산출물 로그/DB)

## 메모
- 현재 crawler 코드에는 `backend ingest` 직접 전송 로직이 없어, 테스트 시 변환/호출 경로로 검증함
- 다음 작업으로 `crawler -> backend` 직접 전송 모듈을 붙이면 운영 흐름과 완전히 동일해짐
